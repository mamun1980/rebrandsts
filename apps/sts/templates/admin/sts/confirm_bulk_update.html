{% extends "admin/base_site.html" %}
{% load i18n %}
{% block extrastyle %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
    select {
        padding-top: 0;
        padding-bottom: 0;
    }
</style>
{% endblock %}


{% block content %}
<div class="container">

    <form method="post" action="{% url 'admin:perform-custom-action' %}">
        {% csrf_token %}
    <div class="row">
        <div class="col-12">
            <h4>{% trans "Confirm bulk update for the following sites:" %}</h4>
        </div>
        {% for obj in selected_objects %}
        <input type="hidden" name="selected_objects" value="{{ obj }}">
        {% endfor %}
        <p>BrandLocationDefinedRatioSets with following ids are selected</P>
            {{ selected_objects }}
    </div>
    <hr>
    <div class="row">

        <div class="col-12 mt-3">

            <div class="row">
                <div class="col-8 badge bg-danger mb-3 p-2 " id="warning">
                    <h5>Total ratio should be exactly 100! Now Total ratio is: <span id="total_ratio">0</span></h5>
                </div>
                <div class="col-md-8 card p-3 bg-light">
                    <div class="list-unstyled card-columns" style="column-count: 3;">
                      {% for partner in partners %}
                          <label for="{{ partner.name }}" class="form-label">{{ partner.name }}</label>
                          <input type="number" class="form-control" name="partner_ratios"
                                 id="{{ partner.name }}" min="0" max="100" value="0">
                            <input type="hidden" name="partner_ids" value="{{ partner.id }}">
                      {% endfor %}

                    </div>

                </div>
                
            </div>

        </div>
        <div class="col-2 mt-4 offset-2">
            <button type="submit" id="submit-button" class="btn btn-success" name="action" value="confirm_admin_action"
            disabled="true">
              {% trans "Confirm Bulk Update" %}
            </button>
        </div>

        <div class="col-2 mt-4">
            <a href="/sts/brandlocationdefinedsetsratio/" class="btn btn-danger text-white">
              {% trans "Cancel" %}
            </a>
        </div>

    </div>
    </form>

</div>


<script>
    $(document).ready(function() {
        function updateTotal() {
            var total = 0;
            $("input[type=number][name='partner_ratios']").each(function() {
                if($(this).val()){
                    total += parseInt($(this).val());
                }

            });
            console.log(total);
            $("#total_ratio").text(total);
            return total;
        }

        $("input[type=number][name='partner_ratios']").on('keyup', function() {
            var total = updateTotal()
            if(total == 100){
                $("#submit-button").prop("disabled", false);
                $("#warning").hide()
            } else {
                $("#submit-button").prop("disabled", true);
                $("#warning").show()
            }
        });
    });
</script>

{% endblock content %}
