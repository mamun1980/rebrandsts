{% load i18n admin_urls static %}
<style>
    .ms-options-ul{
        color: #121212;
    }
    #ms-list-1 > div > a,
    #ms-list-2 > div > a,
    #ms-list-3 > div > a,
    #ms-list-4 > div > a{
        color: #121212;
    }
    .sts-filter h3 {
        font-size: 16px;
        font-weight: bold;
    }


</style>


<div class="sts-filter">
    <h3>{% blocktrans with filter_title=title %} By {{ filter_title }} {% endblocktrans %}</h3>

    <ul>
        {% for choice in choices|slice:":1" %}
            <li{% if choice.selected %} class="selected"{% endif %}>
                <a href="{{ choice.query_string|iriencode }}" data-key="{{ choice.key }}" title="{{ choice.display }}">{{ choice.display }}</a></li>
            </li>
        {% endfor %}
        <li>
            <select id="{{ title|slugify }}_select" name="langOpt[]" multiple style="color:#999;width:100%">
            {% for choice in choices|slice:"1:" %}
                {% if choice.display != '-' %}
                    <option{% if choice.selected %} selected{% endif %}
                        value="{{ choice.value }}"
                        data-key="{{ choice.key }}"
                        data-query="{{ choice.query_string|iriencode }}">
                        {{ choice.display }}
                    </option>
                {% endif %}
            {% endfor %}
            </select>
        </li>
    </ul>
</div>

<script>
$(document).ready(function() {

    $('#{{ title|slugify }}_select').multiselect({
        columns: 1,
        maxPlaceholderOpts: 1,
        texts: {
            search          : 'Search {{ title }}',
            placeholder     : 'Select options',
            selectAll       : 'Select all',
            unselectAll     : 'Unselect all'
        },
        search: true,
        selectAll: true,
        onOptionClick : function( element, option ){
            var param_key = element.getAttribute('id');
            var param_query = element.options[0].dataset['key'];
            var params = {};
            var query = null;

            $('select#{{ title|slugify }}_select > option:selected').each(function() {
                var key = $(this).attr('data-key');

                if (! params.hasOwnProperty(key)) params[key] = [];
                if ($(this).is(':selected')) {
                    params[key].push($(this).val());
                    if (!query) query = $(this).attr('data-query');
                } else {
                    // Remove the value from params[key] if deselected
                    var index = params[key].indexOf($(this).val());
                    if (index !== -1) {
                        params[key].splice(index, 1);
                    }
                }
            });

            const newUrl = new URL(window.location.href);
            const searchParams = new URLSearchParams(newUrl.search);

            if (!query) {
                if (searchParams.has(param_query)) {
                    searchParams.delete(param_query);
                    newUrl.search = searchParams.toString();
                    window.location.href = newUrl.href;
                }
                return false;
            }

            var params_query = '';
            for (var key in params) {
                if (params.hasOwnProperty(key)) {
                    params_query += '&' + key + '=' + params[key].join()
                }
            }

            new_href = query + params_query;

            window.location.href = new_href


        },

    });

});

</script>
